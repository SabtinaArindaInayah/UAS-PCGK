<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Deteksi Jalan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="main-bg">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                ‚ú® Deteksi Jalan 
            </span>
            <p class="nav-subtitle">Analisis Jalan Dengan Gambar</p>
        </div>
    </nav>

    <div class="container-fluid py-5">
        <!-- Header Section -->
        <section class="header-section text-center mb-5">
            <div class="header-content">
                <div class="header-emoji"></div>
                <h1 class="header-title">
                    Deteksi Jalan Berlubang
                </h1>
                <p class="header-subtitle">Upload foto jalan Anda dan biarkan kami menganalisisnya dengan akurat ‚ú®</p>
            </div>
        </section>

        <!-- Upload Section -->
        <section class="row mb-5">
            <div class="col-lg-8 mx-auto">
                <div class="upload-card">
                    <form method="POST" enctype="multipart/form-data" id="uploadForm" class="upload-form">
                        <div class="upload-container">
                            <div class="upload-icon">
                                <span>üì∏</span>
                            </div>
                            <h3>Unggah Foto Jalan</h3>
                            <p class="upload-text">Drag & drop foto di sini atau klik untuk memilih</p>
                            <input type="file" name="image" id="imageInput" accept="image/*" required class="file-input">
                            <label for="imageInput" class="browse-btn">
                                üì∑ Pilih Foto
                            </label>
                            <div id="fileName" class="file-name mt-3"></div>
                        </div>
                        <button type="submit" class="submit-btn" id="submitBtn">
                            ‚ú® Analisis Sekarang
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        {% if data %}
        <section class="results-section">
            <!-- Main Statistics -->
            <div class="row mb-5">
                <div class="col-lg-10 mx-auto">
                    <h2 class="section-title">
                        üìä Hasil Analisis
                    </h2>
                    
                    <div class="row g-4 mb-5">
                        <!-- Status Card -->
                        <div class="col-md-6 col-lg-3">
                            <div class="stat-card status-card">
                                <div class="stat-icon status-icon">
                                    üõ£Ô∏è
                                </div>
                                <div class="stat-content">
                                    <p class="stat-label">Status Jalan</p>
                                    <h3 class="stat-value status-{% if data.kondisi == 'Sangat Baik' %}good{% elif data.kondisi == 'Rusak Sedang' %}medium{% else %}critical{% endif %}">
                                        {{ data.kondisi }}
                                    </h3>
                                </div>
                            </div>
                        </div>

                        <!-- Damage Percentage -->
                        <div class="col-md-6 col-lg-3">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    üìà
                                </div>
                                <div class="stat-content">
                                    <p class="stat-label">Tingkat Kerusakan</p>
                                    <h3 class="stat-value">{{ data.kerusakan }}%</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Total Potholes -->
                        <div class="col-md-6 col-lg-3">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    ‚ö†Ô∏è
                                </div>
                                <div class="stat-content">
                                    <p class="stat-label">Total Lubang</p>
                                    <h3 class="stat-value">{{ data.total_lubang }}</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Damage Progress -->
                        <div class="col-md-6 col-lg-3">
                            <div class="stat-card">
                                <div class="progress-ring-container">
                                    <div class="circular-progress" style="--progress: {{ data.kerusakan }}%">
                                        <svg width="120" height="120" viewBox="0 0 120 120">
                                            <circle cx="60" cy="60" r="50" class="progress-ring-base"></circle>
                                            <circle cx="60" cy="60" r="50" class="progress-ring-fill"></circle>
                                        </svg>
                                    </div>
                                    <div class="progress-text">{{ data.kerusakan }}%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Pothole Count -->
                    <div class="detail-card mb-5">
                        <h3 class="detail-title"> Klasifikasi Lubang</h3>
                        <div class="row g-4 mt-2">
                            <div class="col-md-4">
                                <div class="pothole-type pothole-small">
                                    <div class="pothole-icon">
                                        ‚óè
                                    </div>
                                    <div class="pothole-info">
                                        <h4>Lubang Kecil</h4>
                                        <p class="pothole-count">{{ data.lubang_kecil }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="pothole-type pothole-medium">
                                    <div class="pothole-icon">
                                        ‚óè
                                    </div>
                                    <div class="pothole-info">
                                        <h4>Lubang Sedang</h4>
                                        <p class="pothole-count">{{ data.lubang_sedang }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="pothole-type pothole-large">
                                    <div class="pothole-icon">
                                        ‚óè
                                    </div>
                                    <div class="pothole-info">
                                        <h4>Lubang Besar</h4>
                                        <p class="pothole-count">{{ data.lubang_besar }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detection Result -->
            <div class="row mb-5">
                <div class="col-lg-10 mx-auto">
                    <div class="result-image-card">
                        <h3 class="detail-title">
                            ‚úÖ Hasil Deteksi
                        </h3>
                        <img src="data:image/jpeg;base64,{{ data.result }}" class="result-image" alt="Hasil Deteksi">
                    </div>
                </div>
            </div>

            <!-- Process Visualization -->
            <div class="row mb-5">
                <div class="col-lg-10 mx-auto">
                    <h3 class="section-title">
                        üé® Proses Pengolahan Citra
                    </h3>
                    <div class="row g-4">
                        <div class="col-md-6 col-lg-3">
                            <div class="process-card">
                                <div class="process-step">1Ô∏è‚É£</div>
                                <img src="data:image/jpeg;base64,{{ data.roi }}" class="process-image" alt="ROI">
                                <h5>Region of Interest</h5>
                                <p>Area aspal dipilih</p>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="process-card">
                                <div class="process-step">2Ô∏è‚É£</div>
                                <img src="data:image/jpeg;base64,{{ data.gray }}" class="process-image" alt="Grayscale + CLAHE">
                                <h5>Kontras Ditingkatkan</h5>
                                <p>Grayscale + CLAHE</p>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="process-card">
                                <div class="process-step">3Ô∏è‚É£</div>
                                <img src="data:image/jpeg;base64,{{ data.thresh }}" class="process-image" alt="Threshold">
                                <h5>Segmentasi Dilakukan</h5>
                                <p>Adaptive Threshold</p>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="process-card">
                                <div class="process-step">4Ô∏è‚É£</div>
                                <img src="data:image/jpeg;base64,{{ data.morph }}" class="process-image" alt="Morfologi">
                                <h5>Kontur Ditampilkan</h5>
                                <p>Morfologi</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Analysis Button -->
            <div class="row mb-5">
                <div class="col-lg-10 mx-auto text-center">
                    <button class="new-analysis-btn" onclick="location.reload()">
                        üîÑ Analisis Foto Lain
                    </button>
                </div>
            </div>
        </section>
        {% endif %}
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>üíñ Deteksi kerusakan jalan - Sistem Analisis Jalan  üíñ</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // File input handling
        const fileInput = document.getElementById('imageInput');
        const fileNameDisplay = document.getElementById('fileName');
        const uploadContainer = document.querySelector('.upload-container');
        const uploadForm = document.getElementById('uploadForm');

        // Show filename when selected
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                fileNameDisplay.innerHTML = `<span class="badge badge-success">‚ú® ${this.files[0].name} dipilih!</span>`;
            }
        });

        // Drag and drop
        uploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadContainer.classList.add('dragover');
        });

        uploadContainer.addEventListener('dragleave', () => {
            uploadContainer.classList.remove('dragover');
        });

        uploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadContainer.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                fileNameDisplay.innerHTML = `<span class="badge badge-success">‚ú® ${files[0].name} dipilih!</span>`;
            }
        });

        // Form submission with loading state
        uploadForm.addEventListener('submit', function(e) {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚è≥ Sedang Dianalisis...';
        });
    </script>
</body>
</html>
